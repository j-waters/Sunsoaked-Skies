import g from"../PersonSprite.js";import{MoveTask as l}from"../../models/Task.js";import c from"../../../web_modules/dat.gui.js";var a=Phaser.Math.Vector2,p=Phaser.GameObjects.Rectangle;export default class u extends g{constructor(t,e,s){super(t,e,s);this.parent=t,this.setInteractive({useHandCursor:!0},Phaser.Geom.Rectangle.Contains),this.on(Phaser.Input.Events.POINTER_DOWN,(o,h,r,i)=>{this.parent.select(this),i.stopPropagation(),console.log("Clicked:",this)}),this.debugGui=new c.GUI(),this.debugGui.add(this.person.roomPosition,"x"),this.debugGui.hide()}incrementMovement(t,e){if(t.isComplete)return;e==null&&(e=3);const s=t.currentTarget.room,o=this.parent.getRoomSprite(s),h=o.personWorldPosition(t.currentTarget.position),r=new a(this.x,this.bottom),i=r.subtract(h).negate(),n=i.length();n>e&&i.setLength(e),this.setPosition(this.x+i.x,this.y+i.y),n<e&&(t.completeStep(),this.incrementMovement(t,i.length()))}update(t,e){this.tasks.current instanceof l&&this.incrementMovement(this.tasks.current)}get roomSprite(){return this.parent.getRoomSprite(this.room)}get room(){return this.person.room}moveToPosition(){const t=this.roomSprite.personWorldPosition(this.person.roomPosition);this.setPosition(t.x,t.y-this.compHeight/2)}get selected(){return this.parent.selected===this}select(){this.highlightBox.setStrokeStyle(this.highlightBox.lineWidth,16755200),this.highlightBox.setVisible(!0),this.debugGui.show()}deselect(){this.highlightBox.setVisible(!1),this.debugGui.hide()}setupHover(){const t=this.generationSettings.strokeThickness/2;this.highlightBox=new p(this.scene,0,0,this.compWidth,this.compHeight),this.highlightBox.setVisible(!1),this.add(this.highlightBox),this.on(Phaser.Input.Events.POINTER_OVER,e=>{this.highlightBox.setStrokeStyle(t,16776960),this.highlightBox.setVisible(!0)}),this.on(Phaser.Input.Events.POINTER_OUT,e=>{this.selected?this.highlightBox.setStrokeStyle(this.highlightBox.lineWidth,16755200):this.highlightBox.setVisible(!1)})}setForward(){super.setForward(),this.setupHover()}}

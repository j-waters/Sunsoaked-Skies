var r=Phaser.Scene,j=Phaser.GameObjects.Container;import{generateArmTexture as g,generateBodyTexture as k,generateHeadTexture as l,generateLegTexture as h}from"../../generation/generatePerson.js";var m=Phaser.GameObjects.Rectangle;import n from"../../generation/pathfinding.js";var u=Phaser.Geom.Point;import o from"../../../web_modules/dat.gui.js";var p=Phaser.Math.Vector2;export default class w extends j{constructor(a,b,c){super(a,0,0,null);this.movementQueue=[],this.parent=a,this.person=b,this.generationSettings=c,this.head=new Phaser.GameObjects.Image(this.scene,0,0,l(this.scene,b,this.generationSettings)),this.head.setOrigin(.5,.9),this.add(this.head),this._body=new Phaser.GameObjects.Image(this.scene,0,0,k(this.scene,b,this.generationSettings)),this.add(this._body),this.arm1=new Phaser.GameObjects.Image(this.scene,0,0,g(this.scene,b,this.generationSettings)),this.arm1.setOrigin(.2,0),this.add(this.arm1),this.arm2=new Phaser.GameObjects.Image(this.scene,0,0,g(this.scene,b,this.generationSettings)),this.arm2.setOrigin(.8,0),this.add(this.arm2),this.leg1=new Phaser.GameObjects.Image(this.scene,0,0,h(this.scene,b,this.generationSettings)),this.leg1.setOrigin(.5,0),this.add(this.leg1),this.leg2=new Phaser.GameObjects.Image(this.scene,0,0,h(this.scene,b,this.generationSettings)),this.leg2.setOrigin(.5,0),this.add(this.leg2),this.setForward();let e=new Phaser.Geom.Rectangle(-this.compWidth/2,-this.compHeight/2,this.compWidth,this.compHeight);this.setSize(this.compWidth,this.compHeight),this.setInteractive({useHandCursor:!0},Phaser.Geom.Rectangle.Contains),this.on(Phaser.Input.Events.POINTER_DOWN,(i,d,f,q)=>{this.parent.select(this),q.stopPropagation(),console.log("Clicked:",this)}),this.debugGui=new o.GUI(),this.debugGui.add(this.person.roomPosition,"x"),this.debugGui.hide()}setForward(){this.leg1.setPosition(this.generationSettings.legConfig.xOffset,this.generationSettings.legConfig.yOffset),this.leg2.setPosition(-this.generationSettings.legConfig.xOffset,this.generationSettings.legConfig.yOffset),this.moveTo(this.leg1,1),this.moveTo(this.leg2,1),this.arm1.setPosition(this.generationSettings.armConfig.xOffset,this.generationSettings.armConfig.yOffset),this.arm2.setPosition(-this.generationSettings.armConfig.xOffset,this.generationSettings.armConfig.yOffset),this.moveTo(this.arm1,3),this.moveTo(this.arm2,3),this.head.setPosition(this.generationSettings.headConfig.xOffset,this.generationSettings.headConfig.yOffset),this.moveTo(this.head,4),this._body.setPosition(0,0),this.moveTo(this._body,2),this.setupHover()}setupHover(){let a=this.generationSettings.strokeThickness/2;this.highlightBox=new m(this.scene,0,0,this.compWidth,this.compHeight),this.highlightBox.setVisible(!1),this.add(this.highlightBox),this.on(Phaser.Input.Events.POINTER_OVER,b=>{this.highlightBox.setStrokeStyle(a,16776960),this.highlightBox.setVisible(!0)}),this.on(Phaser.Input.Events.POINTER_OUT,b=>{this.selected?this.highlightBox.setStrokeStyle(this.highlightBox.lineWidth,16755200):this.highlightBox.setVisible(!1)})}get selected(){return this.parent.selected===this}select(){this.highlightBox.setStrokeStyle(this.highlightBox.lineWidth,16755200),this.highlightBox.setVisible(!0),this.debugGui.show()}deselect(){this.highlightBox.setVisible(!1),this.debugGui.hide()}moveToPosition(){let a=this.roomSprite.personWorldPosition(this.person.roomPosition);this.setPosition(a.x,a.y-this.compHeight/2)}setPosition(a,b,c,e){return super.setPosition(a,b,c,e)}get roomSprite(){return this.parent.getRoomSprite(this.room)}get room(){return this.person.room}toRoom(a){let b=n(this.person,a.room);console.log("Specific route:",b.map(c=>c)),this.movementQueue=b}get bottom(){return this.y+this.compHeight/2}get compWidth(){return this._compWidth=this._compWidth??this.getBounds().width,this._compWidth}get compHeight(){return this._compHeight=this._compHeight??this.getBounds().height,this._compHeight}incrementMovement(a){if(this.movementQueue.length==0)return;a==void 0&&(a=3);let b=this.movementQueue[0].room,c=this.parent.getRoomSprite(b),e=c.personWorldPosition(this.movementQueue[0].position),i=new p(this.x,this.bottom),d=i.subtract(e).negate(),f=d.length();f>a&&d.setLength(a),this.setPosition(this.x+d.x,this.y+d.y),f<a&&(this.person.setRoom(this.movementQueue[0].room,this.movementQueue[0].position),this.movementQueue.shift(),this.incrementMovement(d.length()))}update(a,b){this.incrementMovement()}}

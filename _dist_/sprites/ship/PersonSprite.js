var r=Phaser.Scene,k=Phaser.GameObjects.Container;import{generateArmTexture as g,generateBodyTexture as l,generateHeadTexture as m,generateLegTexture as h}from"../../generation/generatePerson.js";var n=Phaser.GameObjects.Rectangle,t=Phaser.Geom.Point;import o from"../../../web_modules/dat.gui.js";var p=Phaser.Math.Vector2;import{MoveTask as q}from"../../models/Task.js";export default class w extends k{constructor(b,a,d){super(b,0,0,null);this.parent=b,this.person=a,this.generationSettings=d,this.head=new Phaser.GameObjects.Image(this.scene,0,0,m(this.scene,a,this.generationSettings)),this.head.setOrigin(.5,.9),this.add(this.head),this._body=new Phaser.GameObjects.Image(this.scene,0,0,l(this.scene,a,this.generationSettings)),this.add(this._body),this.arm1=new Phaser.GameObjects.Image(this.scene,0,0,g(this.scene,a,this.generationSettings)),this.arm1.setOrigin(.2,0),this.add(this.arm1),this.arm2=new Phaser.GameObjects.Image(this.scene,0,0,g(this.scene,a,this.generationSettings)),this.arm2.setOrigin(.8,0),this.add(this.arm2),this.leg1=new Phaser.GameObjects.Image(this.scene,0,0,h(this.scene,a,this.generationSettings)),this.leg1.setOrigin(.5,0),this.add(this.leg1),this.leg2=new Phaser.GameObjects.Image(this.scene,0,0,h(this.scene,a,this.generationSettings)),this.leg2.setOrigin(.5,0),this.add(this.leg2),this.setForward();let e=new Phaser.Geom.Rectangle(-this.compWidth/2,-this.compHeight/2,this.compWidth,this.compHeight);this.setSize(this.compWidth,this.compHeight),this.setInteractive({useHandCursor:!0},Phaser.Geom.Rectangle.Contains),this.on(Phaser.Input.Events.POINTER_DOWN,(i,j,c,f)=>{this.parent.select(this),f.stopPropagation(),console.log("Clicked:",this)}),this.debugGui=new o.GUI(),this.debugGui.add(this.person.roomPosition,"x"),this.debugGui.hide()}setForward(){this.leg1.setPosition(this.generationSettings.legConfig.xOffset,this.generationSettings.legConfig.yOffset),this.leg2.setPosition(-this.generationSettings.legConfig.xOffset,this.generationSettings.legConfig.yOffset),this.moveTo(this.leg1,1),this.moveTo(this.leg2,1),this.arm1.setPosition(this.generationSettings.armConfig.xOffset,this.generationSettings.armConfig.yOffset),this.arm2.setPosition(-this.generationSettings.armConfig.xOffset,this.generationSettings.armConfig.yOffset),this.moveTo(this.arm1,3),this.moveTo(this.arm2,3),this.head.setPosition(this.generationSettings.headConfig.xOffset,this.generationSettings.headConfig.yOffset),this.moveTo(this.head,4),this._body.setPosition(0,0),this.moveTo(this._body,2),this.setupHover()}setupHover(){let b=this.generationSettings.strokeThickness/2;this.highlightBox=new n(this.scene,0,0,this.compWidth,this.compHeight),this.highlightBox.setVisible(!1),this.add(this.highlightBox),this.on(Phaser.Input.Events.POINTER_OVER,a=>{this.highlightBox.setStrokeStyle(b,16776960),this.highlightBox.setVisible(!0)}),this.on(Phaser.Input.Events.POINTER_OUT,a=>{this.selected?this.highlightBox.setStrokeStyle(this.highlightBox.lineWidth,16755200):this.highlightBox.setVisible(!1)})}get selected(){return this.parent.selected===this}select(){this.highlightBox.setStrokeStyle(this.highlightBox.lineWidth,16755200),this.highlightBox.setVisible(!0),this.debugGui.show()}deselect(){this.highlightBox.setVisible(!1),this.debugGui.hide()}moveToPosition(){let b=this.roomSprite.personWorldPosition(this.person.roomPosition);this.setPosition(b.x,b.y-this.compHeight/2)}setPosition(b,a,d,e){return super.setPosition(b,a,d,e)}get roomSprite(){return this.parent.getRoomSprite(this.room)}get room(){return this.person.room}get tasks(){return this.person.tasks}get bottom(){return this.y+this.compHeight/2}get compWidth(){return this._compWidth=this._compWidth??this.getBounds().width,this._compWidth}get compHeight(){return this._compHeight=this._compHeight??this.getBounds().height,this._compHeight}incrementMovement(b,a){if(b.isComplete)return;a==void 0&&(a=3);let d=b.currentTarget.room,e=this.parent.getRoomSprite(d),i=e.personWorldPosition(b.currentTarget.position),j=new p(this.x,this.bottom),c=j.subtract(i).negate(),f=c.length();f>a&&c.setLength(a),this.setPosition(this.x+c.x,this.y+c.y),f<a&&(b.completeStep(),this.incrementMovement(b,c.length()))}update(b,a){this.tasks.current instanceof q&&this.incrementMovement(this.tasks.current)}}

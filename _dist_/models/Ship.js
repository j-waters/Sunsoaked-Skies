import{generateGrid as f,generateHullGraphic as g,generateTopDownShipGraphic as h}from"../generation/generateShip.js";var i=Phaser.Math.Vector2;import{POSITIVE_ZERO as c}from"../sprites/map/MapShipSprite.js";var o=Phaser.Scene,p=Phaser.Curves.Curve;export default class j{constructor(a){this.turningModifier=100,this.speed=2,this.acceleration=.01,this.rootRoom=a,this.velocity=new i(0,c)}get decelerationDistance(){return Math.pow(this.velocity.length(),2)/(2*this.acceleration)}generateTexture(a,b){if(a.textures.exists("ship_hull"))return a.textures.get("ship_hull");let e=g(this,b);return a.textures.addCanvas("ship_hull",e)}generateTopDownTexture(a){if(a.textures.exists("ship_top_down"))return a.textures.get("ship_top_down");let b=h(this);return a.textures.addCanvas("ship_top_down",b)}static builder(){return new k()}get roomGrid(){return f(this.rootRoom)}get people(){return this.rooms.flatMap(a=>a.people)}get rooms(){let a=[];return this.roomGrid.forEach((b,e)=>{b.forEach((d,l)=>{d&&!a.includes(d)&&(d.setGridPosition(l,e),a.push(d))})}),a}iterateMovement(){if(this.targetCurve){let a=this.targetCurve.getTFromDistance(this.distance),b=this.targetCurve.getPointAt(a);this.velocity.setAngle(this.targetCurve.getTangentAt(a).angle()),this.position=b,this.distance+=this.velocity.length(),this.accelerate(this.targetCurve.getLength()-this.distance<this.decelerationDistance),this.distance>=this.targetCurve.getLength()&&(this.targetCurve=null)}else this.accelerate(!0),this.velocity.length()>c&&this.position.add(this.velocity)}accelerate(a=!1){if(!a&&this.velocity.length()<this.speed)this.velocity.setLength(this.velocity.length()+this.acceleration);else if(a&&this.velocity.length()>.001){let b=this.velocity.length()-this.acceleration;b<c?this.velocity.setLength(c):this.velocity.setLength(b)}this.velocity.length()>this.speed&&this.velocity.setLength(this.speed)}get movementProgress(){return this.targetCurve?this.distance/this.targetCurve.getLength():0}}class k{createRootRoom(a){return this.rootRoom=a,this.rootRoom}build(){let a=new j(this.rootRoom);return a.rootRoom.setShip(a),a}}

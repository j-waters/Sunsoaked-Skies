var o=Phaser.Math.Vector2;console.log("");function a(t){switch(t){case"UP":return"DOWN";case"DOWN":return"UP";case"LEFT":return"RIGHT";case"RIGHT":return"LEFT"}}export default class n{constructor(t,e,i){this.people=[],this.neighbours=[],this._width=t,this._height=e,i==null?this.inside=!0:this.inside=i}get width(){return this._width}get height(){return this._height}get outside(){return!this.inside}addRoom(t,e,i,s){if(t.setShip(this.ship),i==null)switch(e){case"UP":i=new o(0,0);break;case"DOWN":i=new o(0,this.height-1);break;case"LEFT":i=new o(0,0);break;case"RIGHT":i=new o(this.width-1,0);break}s==null&&(s=new o(0,0));const r={room:t,direction:e,thisPosition:i,theirPosition:s,mirror:void 0},h={room:this,direction:a(e),automatic:!0,thisPosition:s,theirPosition:i,mirror:void 0};return r.mirror=h,h.mirror=r,this.neighbours.push(r),t.neighbours.push(h),t}addRoomUp(t,e,i){return this.addRoom(t,"UP",e,i)}addRoomDown(t,e,i){return this.addRoom(t,"DOWN",e,i)}addRoomLeft(t,e,i){return this.addRoom(t,"LEFT",e,i)}addRoomRight(t,e,i){return this.addRoom(t,"RIGHT",e,i)}setGridPosition(t,e){this.gridPosition={x:t,y:e}}setShip(t){this.ship=t,this.neighbours.forEach(e=>{e&&!e.room.ship&&e.room.setShip(t)})}addPerson(t,e){return this.people.includes(t)||this.people.push(t),t.room=this,e?t.roomPosition=e:t.roomPosition=new o(this.people.length-1,this.height-1),this}removePerson(t){this.people.splice(this.people.indexOf(t),1)}onPersonLeave(){this.people.forEach(t=>{t.roomPosition.x>this.firstAvailableSpace&&t.tasks.addMoveTo(this)})}get firstAvailableSpace(){for(let t=0;t<this.personSlots[this.personSlots.length-1].length;t++)if(this.personSlots[this.personSlots.length-1][t]==null)return t}get personSlots(){const t=Array(this.height);return t.fill(Array(n.possiblePositions(this.width)).fill(null)),this.people.forEach(e=>{e.roomPosition.x%1==0&&e.roomPosition.y%1==0&&(t[e.roomPosition.y][e.roomPosition.x]=e)}),t}static possiblePositions(t){return t==1?2:t==2?3:5}}
